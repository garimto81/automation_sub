# PRD-0004 Checklist: Caption Database Schema

**PRD**: [0004-prd-caption-database-schema.md](../../tasks/prds/0004-prd-caption-database-schema.md)
**Version**: 1.2
**Created**: 2026-01-06
**Updated**: 2026-01-06
**Status**: Draft

---

## Phase 1: Migration 실행

### 001_create_caption_tables.sql (PRD-0003 기본)
- [ ] `venues` 테이블 생성
- [ ] `events` 테이블 생성
- [ ] `commentators` 테이블 생성
- [ ] `schedules` 테이블 생성
- [ ] `tournaments` 테이블 생성
- [ ] `blind_levels` 테이블 생성
- [ ] `payouts` 테이블 생성
- [ ] `players` 테이블 생성
- [ ] `player_profiles` 테이블 생성
- [ ] `player_stats` 테이블 생성
- [ ] `chip_history` 테이블 생성
- [ ] `graphics_queue` 테이블 생성
- [ ] 인덱스 30+ 생성

### 002_extend_gfx_schema.sql (PRD-0004 GFX)
- [ ] `feature_tables` 테이블 생성
- [ ] `gfx_sessions` 테이블 생성 (pokerGFX)
- [ ] `hands` 테이블 생성 (GFX Hand)
- [ ] `hand_players` 테이블 생성 (GFX Player)
- [ ] `hand_actions` 테이블 생성 (GFX Event)
- [ ] `community_cards` 테이블 생성 (GFX BOARD CARD)
- [ ] `eliminations` 테이블 생성
- [ ] `soft_contents` 테이블 생성
- [ ] 인덱스 25+ 생성

### 003_create_views_functions.sql (View + 함수)
- [ ] View 11개 생성
  - [ ] `v_tournament_leaderboard`
  - [ ] `v_feature_table_players`
  - [ ] `v_mini_chip_counts`
  - [ ] `v_player_profile`
  - [ ] `v_at_risk_players`
  - [ ] `v_recent_eliminations`
  - [ ] `v_chip_flow`
  - [ ] `v_vpip_stats`
  - [ ] `v_hand_summary`
  - [ ] `v_current_blind_level`
  - [ ] `v_l_bar_standard`
- [ ] 함수 6개 생성
  - [ ] `convert_gfx_card()`
  - [ ] `convert_gfx_hole_cards()`
  - [ ] `calculate_bb_count()`
  - [ ] `calculate_avg_stack_percentage()`
  - [ ] `update_player_ranks()`
  - [ ] `import_gfx_session()`
- [ ] 트리거 생성
  - [ ] `trg_log_chip_change`

## Phase 2: Type Definitions

- [ ] TypeScript 타입 정의 (`types/database.ts`)
- [ ] TypeScript Entity 인터페이스 (`types/entities.ts`)
- [ ] TypeScript Payload 타입 (`types/graphic-payloads.ts`)
- [ ] Python Pydantic 모델 정의
- [ ] API Schema 정의 (OpenAPI)

## Phase 3: Data Migration

- [ ] 기존 데이터 백업
- [ ] 기존 데이터 마이그레이션
- [ ] FK 제약 조건 검증
- [ ] 데이터 무결성 검증

## Phase 4: Integration

- [ ] PRD-0003 DataCollectionAgent 연동
- [ ] PRD-0003 GraphicsTriggerAgent 연동
- [ ] PRD-0001 Frontend 연동 테스트
- [ ] 26개 자막 데이터 매핑 검증

---

## Success Metrics

| Metric | Target | Current | Status |
|--------|--------|---------|--------|
| 테이블 생성 | 20개 | 0 | - |
| View 생성 | 11개 | 0 | - |
| 함수 생성 | 6개 | 0 | - |
| 26개 자막 데이터 커버리지 | 100% | 0% | - |
| 쿼리 응답 시간 | < 50ms | - | - |
| 데이터 무결성 | 100% | - | - |
| TypeScript 컴파일 오류 | 0 | - | - |

---

## Migration Files

| 파일 | 경로 |
|------|------|
| 001 | `scripts/migrations/001_create_caption_tables.sql` |
| 002 | `scripts/migrations/002_extend_gfx_schema.sql` |
| 003 | `scripts/migrations/003_create_views_functions.sql` |
| README | `scripts/migrations/README.md` |

---

## Related

- [PRD-0001 Checklist](./PRD-0001.md)
- [PRD-0003 Checklist](./PRD-0003.md)
- [Migration README](../../scripts/migrations/README.md)
